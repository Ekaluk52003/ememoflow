{% load i18n %}
{% load static %}

<div class="flex flex-col h-full">
    {% if request.user.is_authenticated %}
    
    {% if request.user.is_hijacked %}
    <div class="p-3 mx-2 mb-4 text-white bg-gradient-to-r rounded-xl shadow-lg from-neon-violet to-neon-purple">
        <div class="flex flex-col">
            <div class="mb-2 text-sm font-medium text-center">
                <i data-lucide="venetian-mask" class="inline-block mr-1 w-4 h-4"></i>
                {% blocktrans trimmed with user=request.user %}
                    Impersonating: <em>{{ user }}</em>
                {% endblocktrans %}
            </div>
            <form action="{% url 'hijack:release' %}" method="POST" class="w-full">
                {% csrf_token %}
                <input type="hidden" name="next" value="/admin/accounts/customuser/">
                <button type="submit" class="px-3 py-1.5 w-full text-xs font-bold text-white rounded transition duration-150 ease-in-out bg-black/20 hover:bg-black/40">
                    {% trans 'Stop Impersonating' %}
                </button>
            </form>
        </div>
    </div>
    {% endif %}

    <div class="px-3 mb-2 text-[10px] font-mono text-gray-500 dark:text-gray-500 uppercase tracking-widest mt-2">Main Menu</div>

    <!-- Dashboard / Home -->
    <!-- Assuming 'home' or similar url for dashboard, referencing the first link in original which was 'Your Tasks' for some reason. Let's put a Dashboard link if exists, otherwise stick to flow -->
    
    <!-- Your Tasks -->
    <a href="{% url 'document_approval:documents_to_approve' %}" 
       class="flex items-center px-3 py-2.5 mb-1 rounded-md transition-all duration-200 group
       {% if request.resolver_match.url_name == 'documents_to_approve' %}
       bg-neon-violet text-white shadow-[0_0_15px_rgba(255,95,31,0.4)]
       {% else %}
       text-gray-500 dark:text-gray-400 hover:text-neon-violet dark:hover:text-white hover:bg-neon-violet/10
       {% endif %}">
        <i data-lucide="check-circle" class="w-4 h-4 mr-3 {% if request.resolver_match.url_name != 'documents_to_approve' %}group-hover:text-neon-violet{% endif %} transition-colors"></i>
        <span class="text-sm font-medium">Your Tasks</span>
        {% if pending_count > 0 %}
        <span class="ml-auto flex items-center justify-center w-5 h-5 text-[10px] font-bold rounded-full 
            {% if request.resolver_match.url_name == 'documents_to_approve' %}bg-white text-neon-violet{% else %}bg-neon-violet text-white{% endif %}">
            {{ pending_count }}
        </span>
        {% endif %}
    </a>

    <!-- New Document (Dropdown) -->
    <div x-data="{ isOpen: false }" class="mb-1">
        <button @click="isOpen = !isOpen" 
                class="flex justify-between items-center px-3 py-2.5 w-full text-gray-500 rounded-md transition-all duration-200 dark:text-gray-400 hover:text-neon-violet dark:hover:text-white hover:bg-neon-violet/10 group">
            <div class="flex items-center">
                <i data-lucide="plus-circle" class="mr-3 w-4 h-4 transition-colors group-hover:text-neon-violet"></i>
                <span class="text-sm font-medium">New Document</span>
            </div>
            <i data-lucide="chevron-down" class="w-3 h-3 transition-transform duration-200" :class="{'rotate-180': isOpen}"></i>
        </button>
        
        <div x-show="isOpen" x-cloak
             x-collapse
             class="pl-4 mt-1 space-y-1">
            {% for workflow in workflows %}
            <a href="{% url 'document_approval:submit_document' workflow.id %}" 
               class="flex items-center px-3 py-2 text-sm text-gray-500 rounded-md transition-colors dark:text-gray-400 hover:text-neon-violet hover:bg-neon-violet/5">
                <div class="mr-2 w-1 h-1 bg-gray-400 rounded-full group-hover:bg-neon-violet"></div>
                {{ workflow.name }}
            </a>
            {% empty %}
            <div class="px-3 py-2 text-xs text-gray-400">No workflows available</div>
            {% endfor %}
        </div>
    </div>

    <!-- Diagrams (Dropdown) -->
    <div x-data="{ isOpen: false }" class="mb-1">
        <button @click="isOpen = !isOpen" 
                class="flex justify-between items-center px-3 py-2.5 w-full text-gray-500 rounded-md transition-all duration-200 dark:text-gray-400 hover:text-neon-violet dark:hover:text-white hover:bg-neon-violet/10 group">
            <div class="flex items-center">
                <i data-lucide="git-branch" class="mr-3 w-4 h-4 transition-colors group-hover:text-neon-violet"></i>
                <span class="text-sm font-medium">Diagrams</span>
            </div>
            <i data-lucide="chevron-down" class="w-3 h-3 transition-transform duration-200" :class="{'rotate-180': isOpen}"></i>
        </button>
        
        <div x-show="isOpen" x-cloak
             x-collapse
             class="pl-4 mt-1 space-y-1">
            {% for workflow in workflows %}
            <a href="{% url 'document_approval:workflow_steps' workflow.id %}" 
               class="flex items-center px-3 py-2 text-sm text-gray-500 rounded-md transition-colors dark:text-gray-400 hover:text-neon-violet hover:bg-neon-violet/5">
               <div class="mr-2 w-1 h-1 bg-gray-400 rounded-full group-hover:bg-neon-violet"></div>
               {{ workflow.name }} Flow
            </a>
            {% empty %}
            <div class="px-3 py-2 text-xs text-gray-400">No workflows available</div>
            {% endfor %}
        </div>
    </div>

    <!-- All Documents -->
    <a href="{% url 'document_approval:document_list' %}" 
       class="flex items-center px-3 py-2.5 mb-1 rounded-md transition-all duration-200 group
       {% if request.resolver_match.url_name == 'document_list' %}
       bg-neon-violet text-white shadow-[0_0_15px_rgba(255,95,31,0.4)]
       {% else %}
       text-gray-500 dark:text-gray-400 hover:text-neon-violet dark:hover:text-white hover:bg-neon-violet/10
       {% endif %}">
        <i data-lucide="files" class="w-4 h-4 mr-3 {% if request.resolver_match.url_name != 'document_list' %}group-hover:text-neon-violet{% endif %} transition-colors"></i>
        <span class="text-sm font-medium">All Documents</span>
    </a>

    <!-- Favorite Documents -->
    <a href="{% url 'document_approval:favorite_documents' %}" 
       class="flex items-center px-3 py-2.5 mb-1 rounded-md transition-all duration-200 group
       {% if request.resolver_match.url_name == 'favorite_documents' %}
       bg-neon-violet text-white shadow-[0_0_15px_rgba(255,95,31,0.4)]
       {% else %}
       text-gray-500 dark:text-gray-400 hover:text-neon-violet dark:hover:text-white hover:bg-neon-violet/10
       {% endif %}">
        <i data-lucide="star" class="w-4 h-4 mr-3 {% if request.resolver_match.url_name != 'favorite_documents' %}group-hover:text-neon-violet{% endif %} transition-colors"></i>
        <span class="text-sm font-medium">Favorites</span>
    </a>

    <!-- User List -->
    {% if request.user.is_superuser %}
    <a href="{% url 'accounts:user_list' %}" 
       class="flex items-center px-3 py-2.5 mb-1 rounded-md transition-all duration-200 group
       {% if request.resolver_match.url_name == 'user_list' %}
       bg-neon-violet text-white shadow-[0_0_15px_rgba(255,95,31,0.4)]
       {% else %}
       text-gray-500 dark:text-gray-400 hover:text-neon-violet dark:hover:text-white hover:bg-neon-violet/10
       {% endif %}">
        <i data-lucide="users" class="w-4 h-4 mr-3 {% if request.resolver_match.url_name != 'user_list' %}group-hover:text-neon-violet{% endif %} transition-colors"></i>
        <span class="text-sm font-medium">User List</span>
    </a>
    {% endif %}

    <!-- Divider -->
    <div class="my-4 h-[1px] bg-gray-200 dark:bg-white/5 mx-3"></div>

    <div class="px-3 mb-2 text-[10px] font-mono text-gray-500 dark:text-gray-500 uppercase tracking-widest">Settings</div>

    <!-- Approval Stats -->
    {% if request.user.is_superuser %}
    <a href="{% url 'document_approval:approval_statistics' %}" 
       class="flex items-center px-3 py-2.5 mb-1 rounded-md transition-all duration-200 group
       {% if request.resolver_match.url_name == 'approval_statistics' %}
       bg-neon-violet text-white shadow-[0_0_15px_rgba(255,95,31,0.4)]
       {% else %}
       text-gray-500 dark:text-gray-400 hover:text-neon-violet dark:hover:text-white hover:bg-neon-violet/10
       {% endif %}">
        <i data-lucide="bar-chart-2" class="w-4 h-4 mr-3 {% if request.resolver_match.url_name != 'approval_statistics' %}group-hover:text-neon-violet{% endif %} transition-colors"></i>
        <span class="text-sm font-medium">Statistics</span>
    </a>
    {% endif %}

    <!-- Authorization -->
    <a href="{% url 'document_approval:authorization_list' %}" 
       class="flex items-center px-3 py-2.5 mb-1 rounded-md transition-all duration-200 group
       {% if request.resolver_match.url_name == 'authorization_list' %}
       bg-neon-violet text-white shadow-[0_0_15px_rgba(255,95,31,0.4)]
       {% else %}
       text-gray-500 dark:text-gray-400 hover:text-neon-violet dark:hover:text-white hover:bg-neon-violet/10
       {% endif %}">
        <i data-lucide="shield-check" class="w-4 h-4 mr-3 {% if request.resolver_match.url_name != 'authorization_list' %}group-hover:text-neon-violet{% endif %} transition-colors"></i>
        <span class="text-sm font-medium">Authorization</span>
    </a>

    <!-- Change Password -->
    <a href="{% url 'account_change_password' %}" 
       class="flex items-center px-3 py-2.5 mb-1 rounded-md transition-all duration-200 group
       {% if request.resolver_match.url_name == 'account_change_password' %}
       bg-neon-violet text-white shadow-[0_0_15px_rgba(255,95,31,0.4)]
       {% else %}
       text-gray-500 dark:text-gray-400 hover:text-neon-violet dark:hover:text-white hover:bg-neon-violet/10
       {% endif %}">
        <i data-lucide="key" class="w-4 h-4 mr-3 {% if request.resolver_match.url_name != 'account_change_password' %}group-hover:text-neon-violet{% endif %} transition-colors"></i>
        <span class="text-sm font-medium">Password</span>
    </a>

    <!-- Workflow Management Section (Superuser) -->
    {% if request.user.is_superuser %}
    <div class="my-4 h-[1px] bg-gray-200 dark:bg-white/5 mx-3"></div>
    <div class="px-3 mb-2 text-[10px] font-mono text-gray-500 dark:text-gray-500 uppercase tracking-widest">Admin</div>
    
    <a href="{% url 'document_approval:workflow_list' %}" 
       class="flex items-center px-3 py-2.5 mb-1 rounded-md transition-all duration-200 group
       {% if request.resolver_match.url_name == 'workflow_list' %}
       bg-neon-violet text-white shadow-[0_0_15px_rgba(255,95,31,0.4)]
       {% else %}
       text-gray-500 dark:text-gray-400 hover:text-neon-violet dark:hover:text-white hover:bg-neon-violet/10
       {% endif %}">
        <i data-lucide="settings" class="w-4 h-4 mr-3 {% if request.resolver_match.url_name != 'workflow_list' %}group-hover:text-neon-violet{% endif %} transition-colors"></i>
        <span class="text-sm font-medium">Workflows</span>
    </a>
    
    <a href="{% url 'document_approval:field_list' %}" 
       class="flex items-center px-3 py-2.5 mb-1 rounded-md transition-all duration-200 group
       {% if request.resolver_match.url_name == 'field_list' %}
       bg-neon-violet text-white shadow-[0_0_15px_rgba(255,95,31,0.4)]
       {% else %}
       text-gray-500 dark:text-gray-400 hover:text-neon-violet dark:hover:text-white hover:bg-neon-violet/10
       {% endif %}">
        <i data-lucide="database" class="w-4 h-4 mr-3 {% if request.resolver_match.url_name != 'field_list' %}group-hover:text-neon-violet{% endif %} transition-colors"></i>
        <span class="text-sm font-medium">Dynamic Fields</span>
    </a>

    <div class="p-4 mx-2 mt-4 text-center bg-gray-100 rounded-xl border border-gray-200 dark:bg-white/5 dark:border-white/10">
        <div class="flex justify-center items-center mb-2 text-neon-violet">
            <i data-lucide="shield-alert" class="w-6 h-6"></i>
        </div>
        <h3 class="mb-3 text-sm font-bold text-gray-900 dark:text-white">Super Admin</h3>
        <div class="flex flex-col space-y-2">
            <a href="{% url 'admin:index' %}" target="_blank"
               class="px-3 py-2 w-full text-xs font-medium text-white bg-gray-900 rounded-lg transition-colors hover:bg-black">
                Django Admin
            </a>
            <a href="{% url 'document_approval:user_group_diagram' %}" 
               class="px-3 py-2 w-full text-xs font-medium text-white rounded-lg transition-colors bg-neon-violet/80 hover:bg-neon-violet">
                Permission Map
            </a>
        </div>
    </div>
    {% endif %}
    
    {% endif %} <!-- End is_authenticated -->
</div>