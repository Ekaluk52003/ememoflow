{% extends '_base.html' %}
{% load crispy_forms_tags %}

{% block title %}Change Password{% endblock title %}

{% block content %}
<main class="flex flex-col justify-center items-center py-12 mx-auto min-h-[80vh]">
  <div class="w-full max-w-md p-8 bg-white/50 dark:bg-white/5 backdrop-blur-md border border-gray-200 dark:border-white/10 rounded-2xl shadow-2xl">
    
    {% if token_fail %}
        <!-- Token Fail State -->
        <div class="text-center">
             <div class="inline-flex items-center justify-center w-16 h-16 mb-6 rounded-full bg-red-500/10 ring-1 ring-red-500/50">
                <i data-lucide="x-circle" class="w-8 h-8 text-red-500"></i>
             </div>
             <h1 class="text-3xl font-bold text-gray-900 dark:text-white tracking-tight mb-4">Link Expired</h1>
             <p class="text-gray-600 dark:text-gray-400 mb-8 leading-relaxed">
                The password reset link was invalid or has already been used.
             </p>
             <a href="{% url 'account_reset_password' %}" class="block w-full px-5 py-3 text-sm font-bold text-white bg-neon-violet rounded-lg shadow-[0_0_15px_rgba(255,95,31,0.4)] hover:bg-neon-purple transition-all hover:shadow-[0_0_20px_rgba(255,95,31,0.6)] focus:ring-4 focus:outline-none focus:ring-neon-violet/30">
                Request New Link
             </a>
        </div>

    {% else %}
        
        {% if form %}
            <!-- Change Password Form -->
            <div class="mb-8 text-center">
                <div class="inline-flex items-center justify-center w-12 h-12 mb-4 rounded-full bg-neon-violet/10 ring-1 ring-neon-violet/50">
                    <i data-lucide="lock-keyhole" class="w-6 h-6 text-neon-violet"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-900 dark:text-white tracking-tight">Set New Password</h1>
                <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Please enter your new password below</p>
            </div>

            <form method="POST" action=".">
                {% csrf_token %}
                <div class="[&_input]:bg-white/50 [&_input]:dark:bg-white/5 [&_input]:border-gray-200 [&_input]:dark:border-white/10 [&_input]:text-gray-900 [&_input]:dark:text-white [&_input]:rounded-lg [&_input]:focus:ring-neon-violet [&_input]:focus:border-neon-violet [&_label]:text-gray-700 [&_label]:dark:text-gray-300 [&_label]:font-medium [&_.form-group]:mb-6">
                    {{ form|crispy }}
                </div>
                
                <button class="w-full px-5 py-3 mt-4 text-sm font-bold text-white bg-neon-violet rounded-lg shadow-[0_0_15px_rgba(255,95,31,0.4)] hover:bg-neon-purple transition-all hover:shadow-[0_0_20px_rgba(255,95,31,0.6)] focus:ring-4 focus:outline-none focus:ring-neon-violet/30" type="submit">
                    Change Password
                </button>
            </form>

        {% else %}
            <!-- Success State (just in case) -->
            <div class="text-center">
                 <div class="inline-flex items-center justify-center w-16 h-16 mb-6 rounded-full bg-green-500/10 ring-1 ring-green-500/50">
                    <i data-lucide="check-circle-2" class="w-8 h-8 text-green-500"></i>
                 </div>
                 <h1 class="text-3xl font-bold text-gray-900 dark:text-white tracking-tight mb-4">Password Changed</h1>
                 <p class="text-gray-600 dark:text-gray-400 mb-8 leading-relaxed">
                    Your password has been successfully changed.
                 </p>
                 <a href="{% url 'account_login' %}" class="block w-full px-5 py-3 text-sm font-bold text-white bg-neon-violet rounded-lg shadow-[0_0_15px_rgba(255,95,31,0.4)] hover:bg-neon-purple transition-all hover:shadow-[0_0_20px_rgba(255,95,31,0.6)] focus:ring-4 focus:outline-none focus:ring-neon-violet/30">
                    Log In
                 </a>
            </div>
        {% endif %}

    {% endif %}

  </div>
</main>
{% endblock content%}
