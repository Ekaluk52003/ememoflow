{% extends "_base.html" %}

{% block title %}Resubmit Document{% endblock %}

{% block content %}
<h1 class="mb-4">Resubmit Document</h1>
<form method="post">
    {% csrf_token %}
    <div class="mb-3">
        <label for="title" class="form-label">Title</label>
        <input type="text" class="form-control" id="title" name="title" value="{{ document.title }}" required>
    </div>
    <div class="mb-3">
        <label for="content" class="form-label">Content</label>
        <textarea class="form-control" id="content" name="content" rows="5" required>{{ document.content }}</textarea>
    </div>
    {% for field in dynamic_fields %}
    <div>
        <label for="dynamic_{{ field.id }}">{{ field.name }}:</label>
        {% if field.field_type == 'text' %}
            <input type="text" id="dynamic_{{ field.id }}" name="dynamic_{{ field.id }}"
                   {% if field.required %}required{% endif %} value="{{ field.existing_value }}">
        {% elif field.field_type == 'number' %}
            <input type="number" id="dynamic_{{ field.id }}" name="dynamic_{{ field.id }}"
                   {% if field.required %}required{% endif %} value="{{ field.existing_value }}">
        {% elif field.field_type == 'date' %}
            <input type="date" id="dynamic_{{ field.id }}" name="dynamic_{{ field.id }}"
                   {% if field.required %}required{% endif %} value="{{ field.existing_value }}">
        {% elif field.field_type == 'boolean' %}
            <input type="checkbox" id="dynamic_{{ field.id }}" name="dynamic_{{ field.id }}"
                   {% if field.required %}required{% endif %} {% if field.existing_value %}checked{% endif %}>
        {% elif field.field_type == 'choice' %}
            <select id="dynamic_{{ field.id }}" name="dynamic_{{ field.id }}" {% if field.required %}required{% endif %}>
                <option value="">Select an option</option>
                {% for choice in field.choice_list %}
                    <option value="{{ choice }}" {% if choice == field.existing_value %}selected{% endif %}>{{ choice }}</option>
                {% endfor %}
            </select>
        {% endif %}
    </div>
    {% endfor %}


    {% if workflow.allow_custom_approvers %}

    {% for step in workflow.steps.all %}
    <div class="mb-3">
        <label for="approver_{{ step.id }}" class="form-label">Approver for {{ step.name }}</label>
        <select class="form-select" id="approver_{{ step.id }}" name="approver_{{ step.id }}" required>
            <option value="">Select an approver</option>
            {% for approver in potential_approvers %}
            <option value="{{ approver.id }}">{{ approver.username }}</option>
            {% endfor %}
        </select>
    </div>
    {% endfor %}
    {% endif %}
    <button type="submit" class="btn btn-primary">Resubmit Document</button>
</form>
{% endblock %}