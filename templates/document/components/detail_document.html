

<div class="mt-4">



    <div class="flex items-center justify-between">
        <h3 class="text-lg font-medium leading-6 text-base-content">Document Ref:{{document.document_reference}}</h3>



            <div>
            {% include 'partials/favorite_button.html' with document=document is_favorite=is_favorite %}
            <div>
                <a href="{% url 'document_approval:generate_pdf_report' document.document_reference 1 %}" class="btn btn-primary" target="_blank">PDF Report</a></div>
            </div>






    <div class="p-6 mt-6 mb-6 bg-white border shadow-sm rounded-2xl">
        {% if error_message %}
            <div class="alert alert-danger" role="alert">
                {{ error_message }}
            </div>
        {% endif %}
        <h5 class="mt-4 text-lg font-medium leading-6 text-base-content">Title :
            <span class="text-xl text-gray-600">{{ document.title }} </span>
            <article class="prose-sm prose max-w-none">{{ document.content|safe}}</article>
    </div>


    <div class="p-6 mt-6 mb-6 bg-white border shadow-sm rounded-2xl">
                {% include "partials/document_status.html" %}
  <h5 class="mt-3 text-lg font-medium leading-6 text-base-content">Submitted by:
    <span class="font-bold text-primary text-md">{{ document.submitted_by.username }}</span>

  <h5 class="mt-3 text-lg font-medium leading-6 text-base-content">Submitted at:
    <span class="font-bold text-primary text-md">{{ document.created_at }}</span>

                {% for value in prepared_values %}

                <h5 class="mt-3 text-lg font-medium leading-6 text-base-content">{{ value.name }}:
                        {% if value.field_type == 'product_list' %}
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ลำดับ</th>
                                        <th>รหัสสินค้า</th>
                                        <th>รายการ</th>
                                        <th>จำนวน (แผ่น)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for product in value.value %}
                                        <tr>
                                            <td>{{ product.id }}</td>
                                            <td>{{ product.code }}</td>
                                            <td>{{ product.name }}</td>
                                            <td>{{ product.quantity }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>


                        {% elif value.field_type == 'attachment' %}
                            {% if value.file %}
                                <p><a href="{{ value.file.url }}" class="btn btn-sm btn-primary" target="_blank">Download {{ value.file.name }}</a></p>
                            {% else %}
                                <p>No file attached.</p>
                            {% endif %}
                        {% elif value.field_type == 'boolean' %}
                            <p>{% if value.value %}Yes{% else %}No{% endif %}</p>
                        {% else %}
                        <span class="font-bold text-primary text-md">{{ value.value }}</span></h5>
                        {% endif %}
                {% endfor %}





        </div>


        {% if document.approvals.all|length > 0  %}

        <div class="p-6 mt-6 mb-6 bg-white border shadow-sm rounded-2xl">


            <h3 class="text-lg font-medium leading-6 text-gray-900">Approval Steps</h3>

            {% endif %}
                {% for approval in ordered_approvals %}

                    <div class="p-4 rounded my-2 {% if document.current_step and approval.is_approved is None  %}bg-gray-50{% endif %}{% if approval.is_approved == False %} bg-red-50{% endif %}{% if approval.is_approved == True%} bg-green-50{% endif %}">

                        <div class="flex justify-between">

                            <div>
                                <span class="font-medium">{{ approval.step.name }} - {{ approval.approver.username }}</span>

                                {% if approval.comment %}
                                <p class="mt-2 text-sm text-gray-600"><small>Comment: {{ approval.comment }}</small></p>
                            {% endif %}
                            {% if approval.recorded_at %}
                            <p class="mt-2 text-sm text-gray-600"><small>Record at: {{ approval.recorded_at|date:"F d, Y H:i" }}</small></p>
                            {% endif %}


                            </div>

                            <div>
                              {% if approval.is_approved == True %}
                                <span class="flex items-center px-2 py-1 text-sm text-white bg-green-500 rounded">Approved</span>
                            {% elif approval.is_approved == False %}
                                <span class="flex items-center px-2 py-1 text-sm text-white bg-red-500 rounded">Rejected</span>
                            {% else %}
                                <span class="flex items-center px-2 py-1 text-sm text-white bg-blue-500 rounded">Pending</span>
                            {% endif %}
                            </div>
                        </div>


                    </div>
                {% endfor %}



        </div>


        {% if can_approve %}
<div id="approval-form" class="p-6 mt-6 bg-white rounded-xl">
    <h3 class="mb-6 text-lg font-medium leading-6 text-gray-900">Approve Review</h3>
    <form hx-post="{% url 'document_approval:document_detail' document.document_reference %}" hx-target="#content-div" enctype="multipart/form-data">
        {% csrf_token %}
        <div id="form-errors">
            <!-- Errors will be displayed here -->
        </div>
        {% if user_approval.step.requires_edit %}
        <h3 class="mt-3 mb-3 text-lg font-medium leading-6 text-gray-900">User Input</h3>
        <div class="flex flex-wrap -mx-2">
        {% for editable_field in editable_fields %}
        <div class="mb-3 px-2 {% if editable_field.input_width == 'half' %}md:w-1/2{% else %}w-full{% endif %}">
                <label class="w-full max-w-xs">
                    <div class="label">
                        <span class="label-text">{{ editable_field.name }}{% if editable_field.required %}
                            <span class="text-error">*</span>
                        {% endif %}</span>
                         </div>
                </label>
                {% if editable_field.field_type == 'attachment' %}
                    <input type="file" name="dynamic_{{ editable_field.id }}" id="dynamic_{{ editable_field.id }}" class="w-full file-input file-input-bordered" >

                    {% elif editable_field.field_type == 'choice' %}
                    <select name="dynamic_{{ editable_field.id }}" class="w-full select select-bordered" {% if editable_field.required %}required{% endif %}>
                        <option value="">Select an option</option>
                        {% for choice in editable_field.get_choices %}
                            <option value="{{ choice }}">{{ choice }}</option>
                        {% endfor %}
                    </select>


                    {% elif editable_field.field_type == 'multiple_choice' %}
                    <div class="checkbox-group">

                            {% for choice in editable_field.get_choices %}
                                <div class="checkbox-item">
                                    <input type="checkbox"
                                           id="dynamic_{{ editable_field.id }}_{{ forloop.counter }}"
                                           name="dynamic_{{ editable_field.id }}[]"
                                           value="{{ choice }}"
                                           class="checkbox"
                                           {% if choice in current_values %}checked{% endif %}>
                                    <label for="dynamic_{{ editable_field.id }}_{{ forloop.counter }}">{{ choice }}</label>
                                </div>
                            {% endfor %}

                    </div>


                {% elif editable_field.field_type == 'textarea' %}
                <textarea name="dynamic_{{ editable_field.id }}" class="block w-full mt-1 textarea textarea-bordered" rows="{{ editable_field.textarea_rows }}"></textarea>

                {% elif editable_field.field_type == 'text' %}
                    <input type="text" name="dynamic_{{ editable_field.id }}" class="w-full input input-bordered"  >
                {% elif editable_field.field_type == 'number' %}
                    <input type="number" name="dynamic_{{ editable_field.id }}"class="w-full input input-bordered">
                {% elif editable_field.field_type == 'date' %}
                    <input type="date" name="dynamic_{{ editable_field.id }}"class="w-full input input-bordered" >
                {% elif editable_field.field_type == 'boolean' %}
                    <input type="checkbox" name="dynamic_{{ editable_field.id }}" class="mt-1">
                {% endif %}
            </div>
        {% endfor %}
    </div>
        {% endif %}

        <div class="mb-3 text-xl">
            <div class="flex items-center mb-4">
                <input class="w-8 h-8 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500" type="radio" name="is_approved" id="approve" value="true" required checked>
                <label class="pl-4 font-medium text-gray-900" for="approve">Approve</label>
            </div>
            <div class="flex items-center mb-4">
                <input class="w-8 h-8 text-red-500 bg-gray-100 border-gray-300 rounded focus:ring-red-500"  type="radio" name="is_approved" id="reject" value="false" required>
                <label class="pl-4 font-medium text-red-500" for="reject">Reject</label>
            </div>
        </div>
        <div class="mb-3">
            <label for="comment" class="form-label">Comment:</label>
            <textarea  class="w-full textarea textarea-bordered" name="comment" id="comment" rows="3"></textarea>
        </div>


        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
</div>
{% endif %}



    {% include "partials/document_actions.html" %}



    </div>





