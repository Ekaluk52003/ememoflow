{% extends "_base.html" %}

{% block content %}

<!-- Hero Section -->
<div class="mb-10 relative z-10">
    <h1 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white tracking-tight mb-3 relative">
        Documents <br>
        <span class="text-transparent bg-clip-text bg-gradient-to-r from-neon-violet to-neon-purple text-glow">Requiring Your Action</span>
    </h1>
    <p class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl">
        Review, approve, and track documents that are waiting for your decision.
    </p>
    <!-- Background Glow -->
    <div class="absolute -top-20 -left-20 w-96 h-96 bg-neon-violet/20 blur-[100px] rounded-full -z-10 pointer-events-none"></div>
</div>

{% if documents %}
<div class="space-y-4">
    {% for document in documents %}
    <a hx-get="{% url 'document_approval:document_detail' document.document_reference %}" 
       hx-target="#content-div" 
       hx-push-url="true"  
       hx-indicator=".progress" 
       class="block group cursor-pointer">
       
        <div class="glass-card rounded-xl p-5 transition-all duration-300 hover:bg-white/60 dark:hover:bg-white/10 hover:shadow-[0_0_20px_rgba(255, 95, 31,0.15)] border border-gray-200 dark:border-white/10 relative overflow-hidden">
            <!-- Action Indicator Strip -->
          
            
            <div class="flex flex-col md:flex-row md:items-start justify-between gap-4 relative z-10 pl-2">
                
                <!-- Left Side -->
                <div class="flex-1 min-w-0">
                    <!-- Title & Badges -->
                    <div class="flex flex-wrap items-center gap-3 mb-2">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white truncate pr-2 group-hover:text-neon-violet transition-colors">
                            {{ document.title }}
                        </h3>
                        
                        <!-- Status Badge -->
                         <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider shadow-sm
                            {% if document.status == 'approved' %}
                                bg-green-500/10 text-green-600 dark:text-green-400 border border-green-500/20
                            {% elif document.status == 'rejected' %}
                                bg-red-500/10 text-red-600 dark:text-red-400 border border-red-500/20
                            {% elif document.status == 'in_review' %}
                                bg-[#FCD34D]/10 text-[#D97706] dark:text-[#FCD34D] border border-[#FCD34D]/20
                            {% elif document.status == 'cancel' %}
                                bg-gray-500/10 text-gray-600 dark:text-gray-300 border border-gray-500/20
                            {% else %}
                                bg-gray-500/10 text-gray-600 dark:text-gray-300 border border-gray-500/20
                            {% endif %}
                        ">
                            {{ document.get_status_display }}
                        </span>

                        <!-- Action Required Badges -->
                        {% if document.status == 'in_review' and document.approvals.all %}
                            {% for approval in document.approvals.all %}
                                {% if approval.step == document.current_step and approval.is_approved is None %}
                                    {% if approval.approver == request.user %}
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider shadow-sm bg-blue-500/10 text-blue-600 dark:text-blue-400 border border-blue-500/20 animate-pulse">
                                            Awaiting your approval
                                        </span>
                                    {% elif approval.approver.id in authorized_approvers %}
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider shadow-sm bg-neon-violet/10 text-neon-violet dark:text-neon-violet border border-neon-violet/20">
                                            Approve for {{ approval.approver.username }}
                                        </span>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </div>

                    <!-- Metadata -->
                    <div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 text-sm font-mono text-gray-500 dark:text-gray-300">
                        <div class="flex items-center gap-2">
                            <span class="opacity-60 dark:opacity-50">REF:</span>
                            <span class="font-medium text-gray-800 dark:text-gray-200">#{{ document.document_reference }}</span>
                        </div>
                        <div class="hidden sm:block w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600"></div>
                        
                        <div class="flex items-center gap-2 truncate">
                            <span class="opacity-60 dark:opacity-50">Flow:</span>
                            <span class="font-medium text-gray-800 dark:text-gray-200 truncate">{{ document.workflow.name }}</span>
                        </div>
                        <div class="hidden sm:block w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600"></div>

                        <div class="flex items-center gap-2 truncate">
                            <span class="opacity-60 dark:opacity-50">Step:</span>
                            <span class="font-medium text-gray-800 dark:text-gray-200 truncate">{{ document.current_step.name|default:"N/A" }}</span>
                        </div>
                    </div>
                </div>

                <!-- Right Side -->
                <div class="flex flex-row md:flex-col justify-between md:items-end gap-2 md:gap-1 mt-2 md:mt-0 shrink-0 border-t md:border-t-0 border-gray-100 dark:border-white/5 pt-2 md:pt-0">
                    <!-- User -->
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-gray-500 dark:text-gray-400">By</span>
                        <div class="flex items-center gap-1.5">
                            <div class="w-5 h-5 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-[10px] font-bold text-gray-600 dark:text-gray-300 border border-white/10">
                                {{ document.submitted_by.username|slice:":1"|upper }}
                            </div>
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-200">
                                {{ document.submitted_by.first_name|default:document.submitted_by.username }} {{ document.submitted_by.last_name|slice:":1" }}.
                            </span>
                        </div>
                    </div>
                    
                    <!-- Date -->
                    <div class="text-xs font-mono text-gray-400 dark:text-gray-400 tracking-tight">
                        {{ document.updated_at|date:"d M â€¢ H:i"|upper }}
                    </div>
                </div>
            </div>
        </div>
    </a>
    {% endfor %}
</div>
{% else %}
<div class="flex flex-col items-center justify-center py-20 glass-card rounded-xl border border-gray-200 dark:border-white/10 text-center">
    <div class="w-16 h-16 mb-4 rounded-full bg-gray-100 dark:bg-white/5 flex items-center justify-center">
        <i data-lucide="check-circle" class="w-8 h-8 text-green-500"></i>
    </div>
    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-1">All caught up!</h3>
    <p class="text-gray-500 dark:text-gray-400 text-sm">No documents are currently pending your actions.</p>
</div>
{% endif %}
{% endblock %}