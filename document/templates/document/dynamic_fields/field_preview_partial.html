{% load static %}

<div class="field-preview">
  <div class="mb-2">
    <label for="preview_{{ field.id }}" class="block text-sm font-bold text-gray-700 dark:text-gray-300">
      {{ field.name }}{% if field.required %} <span class="text-red-500">*</span>{% endif %}
    </label>
    {% if field.description %}
    <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">{{ field.description }}</p>
    {% endif %}
  </div>

  {% if field.field_type == 'text' %}
  <input type="text" id="preview_{{ field.id }}" name="preview_{{ field.id }}" 
         class="block px-4 py-2.5 mt-1 w-full placeholder-gray-400 text-gray-900 bg-white rounded-lg border border-gray-300 dark:bg-white/5 dark:border-glass-border dark:text-white focus:ring-2 focus:ring-neon-violet focus:border-transparent dark:placeholder-gray-600 sm:text-sm" 
         placeholder="Text input">

  {% elif field.field_type == 'textarea' %}
  <textarea id="preview_{{ field.id }}" name="preview_{{ field.id }}" rows="{{ field.textarea_rows|default:3 }}" 
            class="block px-4 py-2.5 mt-1 w-full placeholder-gray-400 text-gray-900 bg-white rounded-lg border border-gray-300 dark:bg-white/5 dark:border-glass-border dark:text-white focus:ring-2 focus:ring-neon-violet focus:border-transparent dark:placeholder-gray-600 sm:text-sm" 
            placeholder="Text area input"></textarea>

  {% elif field.field_type == 'number' %}
  <input type="number" id="preview_{{ field.id }}" name="preview_{{ field.id }}" 
         class="block px-4 py-2.5 mt-1 w-full placeholder-gray-400 text-gray-900 bg-white rounded-lg border border-gray-300 dark:bg-white/5 dark:border-glass-border dark:text-white focus:ring-2 focus:ring-neon-violet focus:border-transparent dark:placeholder-gray-600 sm:text-sm" 
         placeholder="0">

  {% elif field.field_type == 'date' %}
  <input type="date" id="preview_{{ field.id }}" name="preview_{{ field.id }}" 
         class="block px-4 py-2.5 mt-1 w-full text-gray-900 bg-white rounded-lg border border-gray-300 dark:bg-white/5 dark:border-glass-border dark:text-white focus:ring-2 focus:ring-neon-violet focus:border-transparent sm:text-sm dark:[color-scheme:dark]">

  {% elif field.field_type == 'boolean' %}
  <div class="flex items-center mt-1">
    <label class="inline-flex relative items-center cursor-pointer">
      <input type="checkbox" id="preview_{{ field.id }}" name="preview_{{ field.id }}" class="sr-only peer">
      <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-neon-violet/30 dark:peer-focus:ring-neon-violet/20 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-neon-violet"></div>
      <span class="ml-3 text-sm font-medium text-gray-900 dark:text-gray-300">Yes</span>
    </label>
  </div>

  {% elif field.field_type == 'choice' %}
  <style>
    .preview-dropdown-bg { background-color: white; border-color: #e5e7eb; }
    .dark .preview-dropdown-bg { background-color: #1e1e1e; border-color: rgba(255, 255, 255, 0.1); }
    .preview-dropdown-item:hover { background-color: #f3f4f6; }
    .dark .preview-dropdown-item:hover { background-color: rgba(255, 255, 255, 0.1); }
  </style>
  <div class="relative" x-data="{ open: false, selected: '' }">
    <button type="button" @click="open = !open" @click.away="open = false"
            class="relative px-4 py-2.5 w-full text-left text-gray-900 bg-white rounded-lg border border-gray-300 dark:bg-white/5 dark:border-white/10 dark:text-white focus:ring-2 focus:ring-neon-violet focus:border-transparent sm:text-sm">
      <span x-text="selected || 'Select an option'" :class="{'text-gray-500 dark:text-gray-400': !selected}">Select an option</span>
      <span class="flex absolute inset-y-0 right-0 items-center px-2 text-gray-700 pointer-events-none dark:text-gray-300">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
      </span>
    </button>
    
    <div x-show="open" x-cloak x-transition
         class="overflow-auto absolute z-50 mt-1 w-full max-h-60 rounded-lg border shadow-lg preview-dropdown-bg">
      <div @click="selected = ''; open = false" 
           class="px-4 py-2 text-gray-900 cursor-pointer preview-dropdown-item dark:text-white">
        Select an option
      </div>
      {% for choice in field.choices_list %}
      <div @click="selected = '{{ choice }}'; open = false" 
           class="px-4 py-2 text-gray-900 cursor-pointer preview-dropdown-item dark:text-white">
        {{ choice }}
      </div>
      {% endfor %}
    </div>
    
    <input type="hidden" name="preview_{{ field.id }}" x-model="selected">
  </div>

  {% elif field.field_type == 'multiple_choice' %}
  <div class="mt-1 space-y-2">
    {% for choice in field.choices_list %}
    <div class="flex items-start">
      <div class="flex items-center h-5">
        <input id="preview_{{ field.id }}_{{ forloop.counter }}" name="preview_{{ field.id }}[]" type="checkbox" value="{{ choice }}" 
               class="w-4 h-4 bg-transparent rounded border-gray-300 text-neon-violet dark:border-glass-border focus:ring-neon-violet">
      </div>
      <div class="ml-3 text-sm">
        <label for="preview_{{ field.id }}_{{ forloop.counter }}" class="font-medium text-gray-700 dark:text-gray-300">{{ choice }}</label>
      </div>
    </div>
    {% endfor %}
  </div>

  {% elif field.field_type == 'attachment' %}
  <div class="flex justify-center px-6 pt-5 pb-6 mt-1 rounded-lg border-2 border-gray-300 border-dashed transition-colors dark:border-glass-border hover:bg-gray-50 dark:hover:bg-white/5 group">
    <div class="space-y-1 text-center">
      <svg class="mx-auto w-12 h-12 text-gray-400 transition-colors group-hover:text-neon-violet" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" 
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
      <div class="flex justify-center text-sm text-gray-600 dark:text-gray-400">
        <label for="preview_{{ field.id }}" class="relative font-medium rounded-md cursor-pointer text-neon-violet hover:text-neon-purple focus-within:outline-none">
          <span>Upload a file</span>
          <input id="preview_{{ field.id }}" name="preview_{{ field.id }}" type="file" class="sr-only" {% if field.multiple_files %}multiple{% endif %}>
        </label>
        <p class="pl-1">or drag and drop</p>
      </div>
      <p class="text-xs text-gray-500 dark:text-gray-500">
        {% if field.allowed_extensions %}
        Allowed: {{ field.allowed_extensions }}
        {% else %}
        All file types accepted
        {% endif %}
      </p>
    </div>
  </div>

  {% elif field.field_type == 'table_list' %}
  <div class="mt-1" x-data="{ 
    rows: [{}],
    columns: [{% for col in field.table_columns_list %}'{{ col }}'{% if not forloop.last %}, {% endif %}{% endfor %}]
  }">
    <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-glass-border">
      <table class="min-w-full divide-y divide-gray-200 dark:divide-glass-border">
        <thead class="bg-gray-50 dark:bg-white/5">
          <tr>
            {% for col in field.table_columns_list %}
            <th scope="col" class="px-3 py-2 text-xs font-medium tracking-wider text-left text-gray-500 uppercase dark:text-gray-400">
              {{ col }}
            </th>
            {% endfor %}
            <th scope="col" class="relative px-3 py-2">
              <span class="sr-only">Actions</span>
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200 dark:bg-white/5 dark:divide-glass-border">
          <template x-for="(row, index) in rows" :key="index">
            <tr>
              <template x-for="col in columns" :key="col">
                <td class="px-3 py-2 text-sm text-gray-500 whitespace-nowrap dark:text-gray-400">
                  <input type="text" :name="`table_{{ field.id }}_${col}[]`" 
                         class="block px-2 py-1 w-full text-gray-900 bg-white rounded border border-gray-300 dark:border-glass-border dark:bg-white/5 dark:text-white focus:ring-1 focus:ring-neon-violet focus:border-transparent sm:text-sm">
                </td>
              </template>
              <td class="px-3 py-2 text-sm font-medium text-right whitespace-nowrap">
                <button type="button" @click="rows.splice(index, 1)" x-show="rows.length > 1"
                        class="text-red-600 hover:text-red-500 dark:text-red-400">
                  <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
              </td>
            </tr>
          </template>
        </tbody>
      </table>
    </div>
    <div class="mt-2">
      <button type="button" @click="rows.push({})" 
              class="inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md border border-transparent transition-colors text-neon-violet bg-neon-violet/10 hover:bg-neon-violet/20 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neon-violet">
        <i data-lucide="plus" class="mr-1 w-3 h-3"></i>
        Add Row
      </button>
    </div>
  </div>

  {% elif field.field_type == 'product_list' %}
  <div class="mt-1" x-data="{ 
    rows: [{}],
    columns: [{% for col in field.product_list_columns_list %}'{{ col }}'{% if not forloop.last %}, {% endif %}{% endfor %}]
  }">
    <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-glass-border">
      <table class="min-w-full divide-y divide-gray-200 dark:divide-glass-border">
        <thead class="bg-gray-50 dark:bg-white/5">
          <tr>
            {% for col in field.product_list_columns_list %}
            <th scope="col" class="px-3 py-2 text-xs font-medium tracking-wider text-left text-gray-500 uppercase dark:text-gray-400">
              {{ col }}
            </th>
            {% endfor %}
            <th scope="col" class="relative px-3 py-2">
              <span class="sr-only">Actions</span>
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200 dark:bg-card-bg dark:divide-glass-border">
          <template x-for="(row, index) in rows" :key="index">
            <tr>
              <template x-for="col in columns" :key="col">
                <td class="px-3 py-2 text-sm text-gray-500 whitespace-nowrap dark:text-gray-400">
                  <input type="text" :name="`product_{{ field.id }}_${col}[]`" 
                         class="block px-2 py-1 w-full text-gray-900 bg-white rounded border border-gray-300 dark:border-glass-border dark:bg-card-bg dark:text-white focus:ring-1 focus:ring-neon-violet focus:border-transparent sm:text-sm">
                </td>
              </template>
              <td class="px-3 py-2 text-sm font-medium text-right whitespace-nowrap">
                <button type="button" @click="rows.splice(index, 1)" x-show="rows.length > 1"
                        class="text-red-600 hover:text-red-500 dark:text-red-400">
                  <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
              </td>
            </tr>
          </template>
        </tbody>
      </table>
    </div>
    <div class="mt-2">
      <button type="button" @click="rows.push({})" 
              class="inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md border border-transparent transition-colors text-neon-violet bg-neon-violet/10 hover:bg-neon-violet/20 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neon-violet">
        <i data-lucide="plus" class="mr-1 w-3 h-3"></i>
        Add Product
      </button>
    </div>
  </div>

  {% else %}
  <div class="mt-1 text-sm italic text-gray-500 dark:text-gray-400">
    Preview not available for this field type
  </div>
  {% endif %}
</div>
